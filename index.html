<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ•´æ‰¹æˆ¿è²¸è©¦ç®—</title>
    <style>
        :root {
            --primary: #007bff;
            --secondary: #6c757d;
            --bg: #f4f7f6;
            --card-bg: #ffffff;
            --text: #333;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 15px;
            line-height: 1.5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        h2 { margin-top: 0; text-align: center; color: #444; }
        
        /* å¡ç‰‡è¨­è¨ˆ */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        /* è¼¸å…¥å€å¡Š */
        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 14px; color: #666; margin-bottom: 5px; }
        
        /* é‡å°è¼¸å…¥æ¡†çš„å„ªåŒ– */
        input[type="number"], input[type="text"] {
            width: 100%;
            padding: 12px;
            font-size: 16px; /* é˜²æ­¢ iOS è‡ªå‹•ç¸®æ”¾ */
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box; 
            background-color: #fafafa;
            /* ç§»é™¤ç€è¦½å™¨é è¨­çš„ä¸Šä¸‹ç®­é ­ */
            -moz-appearance: textfield; 
        }
        /* Chrome, Safari, Edge, Opera ç§»é™¤ä¸Šä¸‹ç®­é ­ */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input:focus { border-color: var(--primary); outline: none; background: #fff; }

        /* æŒ‰éˆ•ç¾¤ */
        .btn-calc {
            width: 100%;
            padding: 15px;
            background-color: var(--primary);
            color: white;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,123,255,0.3);
            transition: transform 0.1s;
        }
        .btn-calc:active { transform: scale(0.98); }

        .btn-back {
            width: 100%;
            padding: 12px;
            background-color: var(--secondary);
            color: white;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .btn-back:active { transform: scale(0.98); }

        /* çµæœå„€è¡¨æ¿ */
        #resultArea { display: none; }
        .status-header {
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            color: white;
            margin-bottom: 15px;
        }
        .ratio-display { font-size: 48px; font-weight: bold; margin: 10px 0; }
        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .result-row:last-child { border-bottom: none; }
        .val { font-weight: bold; }

        /* èª ä¿¡æª¢æŸ¥è¡¨ */
        .check-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .check-table th { background: #666; color: white; padding: 8px; font-size: 12px; }
        .check-table td { border: 1px solid #ddd; padding: 8px; font-size: 14px; text-align: center; }
        .row-gray { background-color: #f9f9f9; }

        .note { font-size: 12px; color: #999; margin-top: 2px; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h2>ğŸ  æ•´æ‰¹æˆ¿è²¸è©¦ç®—</h2>
        
        <div class="input-group">
            <label>è²¸æ¬¾é‡‘é¡ (è¬å…ƒ)</label>
            <input type="number" id="loanWan" placeholder="ä¾‹ï¼š1000" inputmode="decimal">
        </div>
        
        <div style="display:flex; gap:10px;">
            <div class="input-group" style="flex:1">
                <label>å¹´é™ (å¹´)</label>
                <input type="number" id="years" value="40" inputmode="numeric">
            </div>
            <div class="input-group" style="flex:1">
                <label>å¯¬é™ (å¹´)</label>
                <input type="number" id="graceYears" value="5" inputmode="numeric">
            </div>
        </div>

        <div class="input-group">
            <label>å¹´åˆ©ç‡ (%)</label>
            <input type="number" id="rate" value="2.275" step="0.001" inputmode="decimal">
        </div>

        <hr style="border:0; border-top:1px dashed #ddd; margin: 15px 0;">

        <div class="input-group">
            <label>å¹´æ”¶å…¥ (è¬å…ƒ)</label>
            <input type="number" id="incomeWan" placeholder="ä¾‹ï¼š200" inputmode="decimal">
        </div>

        <div style="display:flex; gap:10px;">
            <div class="input-group" style="flex:1">
                <label>æœˆç”Ÿæ´»è²»</label>
                <input type="number" id="living" value="17000" inputmode="decimal">
            </div>
        </div>
        <div class="input-group" style="flex:1">
            <label>å…¶ä»–è²¸æ¬¾æ¯æœˆç¹³æ¬¾é‡‘é¡</label>
            <label style="font-size:12px; color:#888;">é’å®‰ ç„¡å¯¬31749ã€å¯¬2 32778ã€ å¯¬5 34555</label>
            <input type="number" id="otherLoan" value="0" inputmode="decimal">
        </div>

        <button class="btn-calc" onclick="calculate()">é–‹å§‹è©¦ç®—</button>
    </div>

    <div id="resultArea" class="card">
        <div id="statusBox" class="status-header">
            <div id="statusTitle" style="font-size:18px; font-weight:bold;">ç‹€æ…‹</div>
            <div id="ratioDisplay" class="ratio-display">0%</div>
            <div style="font-size:16px;">æ”¶æ”¯æ¯” (å„Ÿä»˜èƒ½åŠ›)</div>
        </div>

        <div class="result-row">
            <span style="color:#007bff;">å¯¬é™å‰æœˆä»˜ (åªç¹³æ¯)</span>
            <span class="val" id="resGracePayment" style="color:#007bff;">0</span>
        </div>
        <div class="result-row">
            <span>å¯¬é™å¾Œæœˆä»˜ (æœ¬åˆ©)</span>
            <span class="val" id="resPostGrace">0</span>
        </div>
        <div class="result-row">
            <span>æ‰‹çºŒè²»ä¼°ç®—(ç¯‰å·¢å…æ”¶)</span>
            <span class="val" id="resFee">0</span>
        </div>
        
        <div style="margin-top: 20px;">
            <strong style="color: #007bff;">æª¢æŸ¥é …ç›®</strong>
            <table class="check-table">
                <tr>
                    <th>å¯¬é™æœŸ</th><th>åˆ©ç‡åº•é™</th><th>å…¶ä»–</th>
                </tr>
                <tr>
                    <td><input type="text" id="checkItem1" placeholder="250%ä»¥ä¸Š5å¹´" style="border:none; bg:transparent; width:100%;"></td>
                    <td><input type="text" id="checkVal1" placeholder="é’å®‰1.775/2.275" style="border:none; width:100%;"></td>
                    <td><input type="text" id="checkRes1" placeholder="æœ‰æˆ¿?æœ‰è²¸?" style="border:none; width:100%;"></td>
                </tr>
                <tr class="row-gray">
                    <td><input type="text" id="checkItem2" placeholder="200%ä»¥ä¸Š2å¹´" style="border:none; bg:transparent; width:100%;"></td>
                    <td><input type="text" id="checkVal2" placeholder="2.185/2.585" style="border:none; width:100%;"></td>
                    <td><input type="text" id="checkRes2" placeholder="è‡ªå‚™æ¬¾ä¾†æº" style="border:none; width:100%;"></td>
                </tr>
            </table>
            <div class="note" style="text-align:right; margin-top:5px;">*å°å¿ƒä¼°åƒ¹æˆæ•¸</div>
        </div>

        <button class="btn-back" onclick="scrollToTop()">è©¦ç®—å®Œæˆï¼Œå›åˆ°å¡«å¯«è³‡æ–™è™•</button>
    </div>
</div>

<script>
    window.onload = function() {
        loadData();
    };

    function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function calculate() {
        let loanWan = Number(document.getElementById('loanWan').value);
        let years = Number(document.getElementById('years').value);
        let graceYears = Number(document.getElementById('graceYears').value);
        let rate = Number(document.getElementById('rate').value);
        let incomeWan = Number(document.getElementById('incomeWan').value);
        let living = Number(document.getElementById('living').value);
        let otherLoan = Number(document.getElementById('otherLoan').value);

        if (!loanWan || !years || !rate || !incomeWan) {
            alert("è«‹å¡«å¯«å®Œæ•´è³‡è¨Šï¼");
            return;
        }

        let loanAmount = loanWan * 10000;
        let monthlyRate = rate / 100 / 12;
        let totalMonths = years * 12;
        let graceMonths = graceYears * 12;
        let payMonths = totalMonths - graceMonths;
        let monthlyIncome = (incomeWan * 10000) / 12;

        let rawFee = loanAmount * 0.001;
        let feeAmount = Math.max(rawFee, 5000);

        let gracePayment = Math.round(loanAmount * monthlyRate);

        let postGracePayment = 0;
        if (monthlyRate > 0) {
            let compound = Math.pow(1 + monthlyRate, payMonths);
            postGracePayment = Math.round((loanAmount * monthlyRate * compound) / (compound - 1));
        } else {
            postGracePayment = Math.round(loanAmount / payMonths);
        }

        let totalOutForRatio = postGracePayment + living + otherLoan;
        let ratio = (totalOutForRatio > 0) ? (monthlyIncome / totalOutForRatio) : 0;
        let ratioPct = (ratio * 100).toFixed(2);

        document.getElementById('resultArea').style.display = 'block';
        document.getElementById('resPostGrace').textContent = postGracePayment.toLocaleString() + " å…ƒ";
        document.getElementById('resFee').textContent = feeAmount.toLocaleString() + " å…ƒ";
        document.getElementById('resGracePayment').textContent = gracePayment.toLocaleString() + " å…ƒ";
        document.getElementById('ratioDisplay').textContent = ratioPct + "%";

        let box = document.getElementById('statusBox');
        let title = document.getElementById('statusTitle');

        box.style.backgroundColor = "#28a745"; 

        if (ratio < 1.2) {
            box.style.backgroundColor = "#FF5809"; 
            title.textContent = "âš ï¸ æ³¨æ„ï¼šå»ºè­°æ¸› 2 æˆ";
        } else if (ratio < 1.4) {
            box.style.backgroundColor = "#02DF82"; 
            title.textContent = "âš ï¸ æ³¨æ„ï¼šå»ºè­°æ¸› 1.5 æˆ";
            box.style.color = "#000"; 
        } else if (ratio < 1.6) {
            box.style.backgroundColor = "#ffc107"; 
            title.textContent = "âš ï¸ æ³¨æ„ï¼šå»ºè­°æ¸› 1 æˆ";
            box.style.color = "#000";
        } else if (ratio < 1.8) {
            box.style.backgroundColor = "#dc3545"; 
            title.textContent = "âš ï¸ æ³¨æ„ï¼šå»ºè­°æ¸› 0.5 æˆ";
            box.style.color = "#fff";
        } else {
            title.textContent = "è²¡å‹™ç‹€æ³å¥åº·";
            box.style.color = "#fff";
        }

        saveData();
        
        document.getElementById('resultArea').scrollIntoView({behavior: "smooth"});
    }

    function saveData() {
        const ids = ['loanWan', 'years', 'graceYears', 'rate', 'incomeWan', 'living', 'otherLoan', 
                     'checkItem1', 'checkVal1', 'checkRes1', 'checkItem2', 'checkVal2', 'checkRes2'];
        const data = {};
        ids.forEach(id => {
            data[id] = document.getElementById(id).value;
        });
        localStorage.setItem('loanCalcData', JSON.stringify(data));
    }

    function loadData() {
        const saved = localStorage.getItem('loanCalcData');
        if (saved) {
            const data = JSON.parse(saved);
            for (let id in data) {
                if(document.getElementById(id)) {
                    document.getElementById(id).value = data[id];
                }
            }
        }
    }
</script>

</body>
</html>
