<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ¿è²¸å£“åŠ›æ¸¬è©¦å„€è¡¨æ¿</title>
    <style>
        :root {
            --primary: #007bff;
            --bg: #f4f7f6;
            --card-bg: #ffffff;
            --text: #333;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 15px;
            line-height: 1.5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        h2 { margin-top: 0; text-align: center; color: #444; }
        
        /* å¡ç‰‡è¨­è¨ˆ */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        /* è¼¸å…¥å€å¡Š */
        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 14px; color: #666; margin-bottom: 5px; }
        input[type="number"], input[type="text"] {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box; /* ç¢ºä¿ padding ä¸æœƒæ’ç ´å¯¬åº¦ */
            background-color: #fafafa;
        }
        input:focus { border-color: var(--primary); outline: none; background: #fff; }

        /* æŒ‰éˆ• */
        .btn-calc {
            width: 100%;
            padding: 15px;
            background-color: var(--primary);
            color: white;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,123,255,0.3);
            transition: transform 0.1s;
        }
        .btn-calc:active { transform: scale(0.98); }

        /* çµæœå„€è¡¨æ¿ */
        #resultArea { display: none; }
        .status-header {
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            color: white;
            margin-bottom: 15px;
        }
        .ratio-display { font-size: 48px; font-weight: bold; margin: 10px 0; }
        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .result-row:last-child { border-bottom: none; }
        .val { font-weight: bold; }

        /* èª ä¿¡æª¢æŸ¥è¡¨ */
        .check-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .check-table th { background: #666; color: white; padding: 8px; font-size: 12px; }
        .check-table td { border: 1px solid #ddd; padding: 8px; font-size: 14px; text-align: center; }
        .row-gray { background-color: #f9f9f9; }

        /* å°å­— */
        .note { font-size: 12px; color: #999; margin-top: 2px; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h2>ğŸ  æˆ¿è²¸å£“åŠ›æ¸¬è©¦</h2>
        
        <div class="input-group">
            <label>è²¸æ¬¾é‡‘é¡ (è¬å…ƒ)</label>
            <input type="number" id="loanWan" placeholder="ä¾‹ï¼š1000">
        </div>
        
        <div style="display:flex; gap:10px;">
            <div class="input-group" style="flex:1">
                <label>å¹´é™ (å¹´)</label>
                <input type="number" id="years" value="40">
            </div>
            <div class="input-group" style="flex:1">
                <label>å¯¬é™ (å¹´)</label>
                <input type="number" id="graceYears" value="5">
            </div>
        </div>

        <div class="input-group">
            <label>å¹´åˆ©ç‡ (%)</label>
            <input type="number" id="rate" value="2.275" step="0.001">
        </div>

        <hr style="border:0; border-top:1px dashed #ddd; margin: 15px 0;">

        <div class="input-group">
            <label>å¹´æ”¶å…¥ (è¬å…ƒ)</label>
            <input type="number" id="incomeWan" placeholder="ä¾‹ï¼š200">
        </div>

        <div style="display:flex; gap:10px;">
            <div class="input-group" style="flex:1">
                <label>æœˆç”Ÿæ´»è²»</label>
                <input type="number" id="living" value="17000">
            </div>
            <div class="input-group" style="flex:1">
                <label>å…¶ä»–è²¸æ¬¾/æœˆ</label>
                <input type="number" id="otherLoan" value="0">
            </div>
        </div>

        <button class="btn-calc" onclick="calculate()">é–‹å§‹è©¦ç®—</button>
    </div>

    <div id="resultArea" class="card">
        <div id="statusBox" class="status-header">
            <div id="statusTitle" style="font-size:18px; font-weight:bold;">ç‹€æ…‹</div>
            <div id="ratioDisplay" class="ratio-display">0%</div>
            <div style="font-size:12px;">æ”¶æ”¯æ¯” (å„Ÿä»˜èƒ½åŠ›)</div>
        </div>

        <div class="result-row">
            <span>å¯¬é™å¾Œæœˆä»˜</span>
            <span class="val" id="resPostGrace">0</span>
        </div>
        <div class="result-row">
            <span>æ‰‹çºŒè²»ä¼°ç®—</span>
            <span class="val" id="resFee">0</span>
        </div>
        <div class="result-row">
            <span>æ¯æœˆç¸½æ”¯å‡º</span>
            <span class="val" id="resTotalOut">0</span>
        </div>

        <div style="margin-top: 20px;">
            <strong style="color: #007bff;">â„¹ï¸ èª ä¿¡æª¢æŸ¥ç´€éŒ„</strong>
            <table class="check-table">
                <tr>
                    <th>é …ç›®</th><th>æ‰¿è«¾/æ•¸æ“š</th><th>çµæœ</th>
                </tr>
                <tr>
                    <td><input type="text" id="checkItem1" placeholder="é …ç›®1" style="border:none; bg:transparent; width:100%;"></td>
                    <td><input type="text" id="checkVal1" placeholder="å…§å®¹" style="border:none; width:100%;"></td>
                    <td><input type="text" id="checkRes1" placeholder="å¾…æŸ¥" style="border:none; width:100%;"></td>
                </tr>
                <tr class="row-gray">
                    <td><input type="text" id="checkItem2" placeholder="é …ç›®2" style="border:none; bg:transparent; width:100%;"></td>
                    <td><input type="text" id="checkVal2" placeholder="å…§å®¹" style="border:none; width:100%;"></td>
                    <td><input type="text" id="checkRes2" placeholder="å¾…æŸ¥" style="border:none; width:100%;"></td>
                </tr>
            </table>
            <div class="note" style="text-align:right; margin-top:5px;">*è³‡æ–™è‡ªå‹•å„²å­˜æ–¼æ‰‹æ©Ÿ</div>
        </div>
    </div>
</div>

<script>
    // é é¢è¼‰å…¥æ™‚ï¼Œè®€å–ä¸Šæ¬¡çš„è³‡æ–™
    window.onload = function() {
        loadData();
    };

    function calculate() {
        // 1. ç²å–è¼¸å…¥
        let loanWan = Number(document.getElementById('loanWan').value);
        let years = Number(document.getElementById('years').value);
        let graceYears = Number(document.getElementById('graceYears').value);
        let rate = Number(document.getElementById('rate').value);
        let incomeWan = Number(document.getElementById('incomeWan').value);
        let living = Number(document.getElementById('living').value);
        let otherLoan = Number(document.getElementById('otherLoan').value);

        // ç°¡æ˜“é©—è­‰
        if (!loanWan || !years || !rate || !incomeWan) {
            alert("è«‹å¡«å¯«å®Œæ•´è³‡è¨Šï¼");
            return;
        }

        // 2. è¨ˆç®—é‚è¼¯
        let loanAmount = loanWan * 10000;
        let monthlyRate = rate / 100 / 12;
        let totalMonths = years * 12;
        let graceMonths = graceYears * 12;
        let payMonths = totalMonths - graceMonths;
        let monthlyIncome = (incomeWan * 10000) / 12;

        // æ‰‹çºŒè²»
        let rawFee = loanAmount * 0.001;
        let feeAmount = Math.max(rawFee, 5000);

        // æœˆä»˜é‡‘
        let postGracePayment = 0;
        if (monthlyRate > 0) {
            let compound = Math.pow(1 + monthlyRate, payMonths);
            postGracePayment = Math.round((loanAmount * monthlyRate * compound) / (compound - 1));
        } else {
            postGracePayment = Math.round(loanAmount / payMonths);
        }

        // æ”¶æ”¯æ¯”
        let totalOut = postGracePayment + living + otherLoan;
        let ratio = (totalOut > 0) ? (monthlyIncome / totalOut) : 0;
        let ratioPct = (ratio * 100).toFixed(2);

        // 3. æ›´æ–° UI
        document.getElementById('resultArea').style.display = 'block';
        document.getElementById('resPostGrace').textContent = postGracePayment.toLocaleString() + " å…ƒ";
        document.getElementById('resFee').textContent = feeAmount.toLocaleString() + " å…ƒ";
        document.getElementById('resTotalOut').textContent = totalOut.toLocaleString() + " å…ƒ";
        document.getElementById('ratioDisplay').textContent = ratioPct + "%";

        // 4. åˆ¤æ–·é¡è‰² (ç´…ç¶ ç‡ˆ)
        let box = document.getElementById('statusBox');
        let title = document.getElementById('statusTitle');

        // æ¸…é™¤èˆŠ class
        box.style.backgroundColor = "#28a745"; // é è¨­ç¶ 

        if (ratio < 1.2) {
            box.style.backgroundColor = "#FF5809"; // æ©˜ç´…
            title.textContent = "âš ï¸ è­¦å‘Šï¼šå»ºè­°æ¸› 2 æˆ";
        } else if (ratio < 1.4) {
            box.style.backgroundColor = "#02DF82"; // è¢å…‰ç¶ 
            title.textContent = "âš ï¸ æ³¨æ„ï¼šå»ºè­°æ¸› 1.5 æˆ";
            box.style.color = "#000"; // è¢å…‰ç¶ é…é»‘å­—æ¯”è¼ƒæ¸…æ¥š
        } else if (ratio < 1.6) {
            box.style.backgroundColor = "#ffc107"; // é»ƒè‰²
            title.textContent = "âš ï¸ æé†’ï¼šå»ºè­°æ¸› 1 æˆ";
            box.style.color = "#000";
        } else if (ratio < 1.8) {
            box.style.backgroundColor = "#dc3545"; // ç´…è‰²
            title.textContent = "âš ï¸ è§€å¯Ÿï¼šå»ºè­°æ¸› 0.5 æˆ";
            box.style.color = "#fff";
        } else {
            title.textContent = "è²¡å‹™ç‹€æ³å¥åº·";
            box.style.color = "#fff";
        }

        // 5. å„²å­˜è³‡æ–™
        saveData();
        
        // æ²å‹•åˆ°çµæœå€
        document.getElementById('resultArea').scrollIntoView({behavior: "smooth"});
    }

    // --- LocalStorage å­˜å–åŠŸèƒ½ ---
    function saveData() {
        const ids = ['loanWan', 'years', 'graceYears', 'rate', 'incomeWan', 'living', 'otherLoan', 
                     'checkItem1', 'checkVal1', 'checkRes1', 'checkItem2', 'checkVal2', 'checkRes2'];
        const data = {};
        ids.forEach(id => {
            data[id] = document.getElementById(id).value;
        });
        localStorage.setItem('loanCalcData', JSON.stringify(data));
    }

    function loadData() {
        const saved = localStorage.getItem('loanCalcData');
        if (saved) {
            const data = JSON.parse(saved);
            for (let id in data) {
                if(document.getElementById(id)) {
                    document.getElementById(id).value = data[id];
                }
            }
        }
    }
</script>

</body>
</html>